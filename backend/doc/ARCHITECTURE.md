# Backend Architecture

## ğŸ“ ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client                              â”‚
â”‚                    (Frontend / curl)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP Request
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Layer                              â”‚
â”‚                  (Gin HTTP Handlers)                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         TransactionHandler                           â”‚  â”‚
â”‚  â”‚  - CreateTransaction()                               â”‚  â”‚
â”‚  â”‚  - GetTransaction()                                  â”‚  â”‚
â”‚  â”‚  - ListTransactions()                                â”‚  â”‚
â”‚  â”‚  - UpdateTransaction()                               â”‚  â”‚
â”‚  â”‚  - DeleteTransaction()                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Service Layer                            â”‚
â”‚                  (Business Logic)                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         TransactionService                           â”‚  â”‚
â”‚  â”‚  - CreateTransaction()    (+ validation)             â”‚  â”‚
â”‚  â”‚  - GetTransaction()                                  â”‚  â”‚
â”‚  â”‚  - ListTransactions()     (+ validation)             â”‚  â”‚
â”‚  â”‚  - UpdateTransaction()    (+ validation)             â”‚  â”‚
â”‚  â”‚  - DeleteTransaction()                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Repository Layer                           â”‚
â”‚                   (Data Access)                             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       TransactionRepository                          â”‚  â”‚
â”‚  â”‚  - Create()                                          â”‚  â”‚
â”‚  â”‚  - GetByID()                                         â”‚  â”‚
â”‚  â”‚  - GetAll()           (+ filters)                    â”‚  â”‚
â”‚  â”‚  - Update()                                          â”‚  â”‚
â”‚  â”‚  - Delete()                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ SQL Queries
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Database                                â”‚
â”‚                   (PostgreSQL)                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         transactions table                           â”‚  â”‚
â”‚  â”‚  - id (UUID, PK)                                     â”‚  â”‚
â”‚  â”‚  - date                                              â”‚  â”‚
â”‚  â”‚  - asset_type                                        â”‚  â”‚
â”‚  â”‚  - symbol                                            â”‚  â”‚
â”‚  â”‚  - name                                              â”‚  â”‚
â”‚  â”‚  - transaction_type                                  â”‚  â”‚
â”‚  â”‚  - quantity                                          â”‚  â”‚
â”‚  â”‚  - price                                             â”‚  â”‚
â”‚  â”‚  - amount                                            â”‚  â”‚
â”‚  â”‚  - fee                                               â”‚  â”‚
â”‚  â”‚  - note                                              â”‚  â”‚
â”‚  â”‚  - created_at                                        â”‚  â”‚
â”‚  â”‚  - updated_at                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ åˆ†å±¤æ¶æ§‹èªªæ˜

### 1. API Layerï¼ˆAPI å±¤ï¼‰
**è·è²¬ï¼š**
- è™•ç† HTTP è«‹æ±‚å’Œå›æ‡‰
- è§£æè«‹æ±‚åƒæ•¸å’Œ JSON body
- å‘¼å« Service å±¤
- æ ¼å¼åŒ–å›æ‡‰ï¼ˆçµ±ä¸€çš„ APIResponse æ ¼å¼ï¼‰
- éŒ¯èª¤è™•ç†å’Œ HTTP ç‹€æ…‹ç¢¼

**æª”æ¡ˆï¼š**
- `internal/api/transaction_handler.go`

**ç‰¹é»ï¼š**
- ä½¿ç”¨ Gin æ¡†æ¶
- RESTful API è¨­è¨ˆ
- çµ±ä¸€çš„éŒ¯èª¤å›æ‡‰æ ¼å¼

---

### 2. Service Layerï¼ˆæœå‹™å±¤ï¼‰
**è·è²¬ï¼š**
- å¯¦ä½œæ¥­å‹™é‚è¼¯
- è³‡æ–™é©—è­‰
- å‘¼å« Repository å±¤
- å”èª¿å¤šå€‹ Repositoryï¼ˆæœªä¾†å¯èƒ½éœ€è¦ï¼‰

**æª”æ¡ˆï¼š**
- `internal/service/transaction_service.go`

**ç‰¹é»ï¼š**
- ç¨ç«‹æ–¼ HTTP æ¡†æ¶
- å¯é‡ç”¨çš„æ¥­å‹™é‚è¼¯
- å®Œæ•´çš„è¼¸å…¥é©—è­‰

---

### 3. Repository Layerï¼ˆè³‡æ–™å­˜å–å±¤ï¼‰
**è·è²¬ï¼š**
- è³‡æ–™åº« CRUD æ“ä½œ
- SQL æŸ¥è©¢å»ºæ§‹
- è³‡æ–™åº«éŒ¯èª¤è™•ç†
- è³‡æ–™æ˜ å°„ï¼ˆDB â†” Modelï¼‰

**æª”æ¡ˆï¼š**
- `internal/repository/transaction_repository.go`

**ç‰¹é»ï¼š**
- ä½¿ç”¨ `database/sql` æ¨™æº–åº«
- æ”¯æ´å‹•æ…‹æŸ¥è©¢å»ºæ§‹
- æ”¯æ´ç¯©é¸å’Œåˆ†é 

---

### 4. Models Layerï¼ˆæ¨¡å‹å±¤ï¼‰
**è·è²¬ï¼š**
- å®šç¾©è³‡æ–™çµæ§‹
- å®šç¾©è¼¸å…¥/è¼¸å‡ºæ ¼å¼
- åŸºæœ¬çš„é©—è­‰æ–¹æ³•

**æª”æ¡ˆï¼š**
- `internal/models/transaction.go`

**ç‰¹é»ï¼š**
- æ¸…æ™°çš„å‹åˆ¥å®šç¾©
- JSON åºåˆ—åŒ–æ¨™ç±¤
- è³‡æ–™åº«æ¬„ä½æ˜ å°„

---

## ğŸ”„ è³‡æ–™æµç¨‹

### å»ºç«‹äº¤æ˜“è¨˜éŒ„çš„æµç¨‹

```
1. Client ç™¼é€ POST è«‹æ±‚
   â†“
2. TransactionHandler.CreateTransaction()
   - è§£æ JSON body
   - ç¶å®šåˆ° CreateTransactionInput
   â†“
3. TransactionService.CreateTransaction()
   - é©—è­‰ asset_type
   - é©—è­‰ transaction_type
   - é©—è­‰ quantity, price, fee
   â†“
4. TransactionRepository.Create()
   - å»ºæ§‹ SQL INSERT èªå¥
   - åŸ·è¡ŒæŸ¥è©¢
   - è¿”å›æ–°å»ºç«‹çš„ Transaction
   â†“
5. å›å‚³çµæœ
   - Service â†’ Handler
   - Handler æ ¼å¼åŒ–ç‚º APIResponse
   - è¿”å› HTTP 201 Created
```

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### 1. Repository å±¤æ¸¬è©¦
**é¡å‹ï¼š** æ•´åˆæ¸¬è©¦ï¼ˆIntegration Testsï¼‰

**ç‰¹é»ï¼š**
- éœ€è¦çœŸå¯¦çš„æ¸¬è©¦è³‡æ–™åº«
- æ¸¬è©¦å¯¦éš›çš„ SQL æŸ¥è©¢
- ä½¿ç”¨ testify/suite ç®¡ç†æ¸¬è©¦ç”Ÿå‘½é€±æœŸ

**æ¸¬è©¦å…§å®¹ï¼š**
- CRUD æ“ä½œ
- ç¯©é¸åŠŸèƒ½
- éŒ¯èª¤è™•ç†

---

### 2. Service å±¤æ¸¬è©¦
**é¡å‹ï¼š** å–®å…ƒæ¸¬è©¦ï¼ˆUnit Testsï¼‰

**ç‰¹é»ï¼š**
- ä½¿ç”¨ Mock Repository
- ä¸éœ€è¦è³‡æ–™åº«
- å¿«é€ŸåŸ·è¡Œ

**æ¸¬è©¦å…§å®¹ï¼š**
- æ¥­å‹™é‚è¼¯
- è³‡æ–™é©—è­‰
- éŒ¯èª¤è™•ç†

---

### 3. API Handler å±¤æ¸¬è©¦
**é¡å‹ï¼š** å–®å…ƒæ¸¬è©¦ï¼ˆUnit Testsï¼‰

**ç‰¹é»ï¼š**
- ä½¿ç”¨ Mock Service
- ä½¿ç”¨ httptest æ¨¡æ“¬ HTTP è«‹æ±‚
- ä¸éœ€è¦è³‡æ–™åº«

**æ¸¬è©¦å…§å®¹ï¼š**
- HTTP è«‹æ±‚è™•ç†
- å›æ‡‰æ ¼å¼
- éŒ¯èª¤è™•ç†
- ç‹€æ…‹ç¢¼

---

## ğŸ“¦ ä¾è³´æ³¨å…¥

æˆ‘å€‘ä½¿ç”¨å»ºæ§‹å‡½å¼æ³¨å…¥ï¼ˆConstructor Injectionï¼‰ä¾†ç®¡ç†ä¾è³´ï¼š

```go
// main.go
func main() {
    // 1. åˆå§‹åŒ–è³‡æ–™åº«
    db := db.InitDB()
    
    // 2. å»ºç«‹ Repositoryï¼ˆæ³¨å…¥è³‡æ–™åº«ï¼‰
    repo := repository.NewTransactionRepository(db)
    
    // 3. å»ºç«‹ Serviceï¼ˆæ³¨å…¥ Repositoryï¼‰
    service := service.NewTransactionService(repo)
    
    // 4. å»ºç«‹ Handlerï¼ˆæ³¨å…¥ Serviceï¼‰
    handler := api.NewTransactionHandler(service)
    
    // 5. è¨»å†Šè·¯ç”±
    router.POST("/api/transactions", handler.CreateTransaction)
    // ...
}
```

**å„ªé»ï¼š**
- æ¸…æ™°çš„ä¾è³´é—œä¿‚
- æ˜“æ–¼æ¸¬è©¦ï¼ˆå¯ä»¥æ³¨å…¥ Mockï¼‰
- æ˜“æ–¼ç¶­è­·å’Œæ“´å±•

---

## ğŸ” éŒ¯èª¤è™•ç†

### çµ±ä¸€çš„éŒ¯èª¤å›æ‡‰æ ¼å¼

```json
{
  "data": null,
  "error": {
    "code": "ERROR_CODE",
    "message": "Error message"
  }
}
```

### éŒ¯èª¤ç¢¼å®šç¾©

| éŒ¯èª¤ç¢¼ | èªªæ˜ | HTTP ç‹€æ…‹ç¢¼ |
|--------|------|-------------|
| `INVALID_INPUT` | è¼¸å…¥è³‡æ–™æ ¼å¼éŒ¯èª¤ | 400 |
| `INVALID_ID` | ID æ ¼å¼éŒ¯èª¤ | 400 |
| `INVALID_DATE` | æ—¥æœŸæ ¼å¼éŒ¯èª¤ | 400 |
| `NOT_FOUND` | è³‡æºä¸å­˜åœ¨ | 404 |
| `CREATE_FAILED` | å»ºç«‹å¤±æ•— | 500 |
| `UPDATE_FAILED` | æ›´æ–°å¤±æ•— | 500 |
| `DELETE_FAILED` | åˆªé™¤å¤±æ•— | 500 |
| `LIST_FAILED` | æŸ¥è©¢å¤±æ•— | 500 |

---

## ğŸš€ æ“´å±•æ€§è€ƒé‡

### æœªä¾†å¯èƒ½çš„æ“´å±•

1. **å¿«å–å±¤**
   - ä½¿ç”¨ Redis å¿«å–å¸¸ç”¨æŸ¥è©¢
   - æ¸›å°‘è³‡æ–™åº«è² è¼‰

2. **è¨Šæ¯ä½‡åˆ—**
   - ä½¿ç”¨ RabbitMQ æˆ– Kafka
   - è™•ç†éåŒæ­¥ä»»å‹™ï¼ˆå¦‚åƒ¹æ ¼æ›´æ–°ï¼‰

3. **å¾®æœå‹™æ‹†åˆ†**
   - Transaction Service
   - Holdings Service
   - Analytics Service

4. **API ç‰ˆæœ¬æ§åˆ¶**
   - `/api/v1/transactions`
   - `/api/v2/transactions`

5. **èªè­‰èˆ‡æˆæ¬Š**
   - JWT Token
   - Role-based Access Control (RBAC)

---

## ğŸ“š ç›¸é—œæ–‡ä»¶

- `README_PHASE1.md` - è©³ç´°å¯¦ä½œæŒ‡å—
- `PHASE1_SUMMARY.md` - Phase 1 å®Œæˆç¸½çµ
- `QUICK_START.md` - å¿«é€Ÿé–‹å§‹æŒ‡å—

